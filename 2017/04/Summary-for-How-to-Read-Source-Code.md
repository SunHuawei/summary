[如何阅读一份代码？](https://zhuanlan.zhihu.com/p/26222486)的摘要



如何阅读一份范围可能从几千行到数万行，有时甚至可多达数十万行的代码？

1. 选定合理的代码规模；几十 k 体量的代码，就像一本不薄不厚的书，读着既不算太过吃力，也不至于读完意犹未尽。
2. 选择要阅读的源码；可以分而治之，先定个小目标，每次读一部分

与『如何阅读一本书』进行类比的读大型代码项目的思路：

1. 读根目录下的 readme或其他介绍性文件，了解这份代码的意图。
2. 代码的目录结构，和每个源码的文件名；快速掌握大致结构。
3. 从入口梳理主线。（application 的主线比较清晰，一路下来，会走到一个 mainloop，而 framework 的主线会晦涩一些，因为 framework 往往是 application 抽象出来的部分。）

本文将通过**阅读的场景**来谈谈如何阅读。循着一条线索，进行端到端的一个自成体系的内容的阅读

# # 场景一：为了破案而阅读代码(「猎手模式」)

当遇到棘手的bug时，你会抛开一切纷扰和杂音，集中精力，带着线索，循着问题，读且只读和解决问题直接相关的代码。

为了破案而阅读代码要注意什么：

1. 带着线索，从一堆代码中找出和问题相关的代码。
2. 专注阅读挑出来的内容，忽略不相干的噪音。在阅读的过程中，着力寻找潜在的触发问题的路径，然后动用「我猜我猜我猜猜猜」大法，加调试信息。
3. 编译运行修改过的代码，复现问题，分析调试信息
4. **复盘，复盘，复盘**，不复盘你70%的功夫就白费了

**复盘**，记录关键代码，关键路径，到达终点的整个猜测过程，以及那些日志验证了猜测是对的，哪些日志验证了猜测走不通。

分析总结：

- 这个问题的 root cause 是什么？触发它的代码的流程是什么？
- 在读代码的过程中，哪些地方我猜对了，哪些没猜对？
- 有功夫的话，代码的哪个部分是值得细细品读把玩的？
- 下次再出现类似的问题，我该怎么更快地从源码中定位出问题？

# 场景二：为了明理而阅读代码「主动模式」

在看过书，读过文章后我们都似懂非懂，这时，阅读代码就是最快地巩固和加深理解的方式。

你读的书多，你脑子里的知识点就多，疑问同样也多。这些疑问促使你读相关的代码去印证和解惑，代码读多了，又感觉理论知识欠缺，于是周而复始，不断学习下去。

读完之后，我一般会问问：

- 这代码有可以优化的地方么？
- 有潜在的安全漏洞么？
- 是否有未处理的状态或者异常？

「主动模式」的方法：

1. 先使用「检视阅读法」把整个代码过一遍，找到值得阅读的核心代码。
2. 粗读这部分代码，将其内容进一步 breakdown。手边准备好笔和纸（或者其他趁手的工具），随时记录。记录最好的方式是图表。这个阶段的记录不建议用软件工具（除非有用着特别舒服的，能够人件合一的）。
3. 精读这部分代码，结合你已有的知识，理解这个代码所需要的资料，猜测和还原代码中某种事件，消息，或者某个流程发生的场景。把猜测记录下来。这时，如果遇到外围的代码（调用了外部的函数），只要对理解不产生障碍，可以先放一下，把整个过程完整而详细地捋一遍再说。这个过程一定要多问问题，把「我以为我懂了但实际没懂」的情形尽可能减少。
4. 用「检视阅读法」粗读剩下的代码，如果找到其他值得精读的代码，跳至 2。
5. 使用对比阅读（或者说，主题阅读）方式，把类似功能的 repo 都扫一遍。尝试着用自己的语言消化不同作者的实现，关注其实现的差异，并试图评判这种差异。
6. 用软件将手稿电子化，便于将来回顾。

# 场景三：为了能级跃迁而阅读代码

读那些基础地不能再基础，你认为自己一辈子都不会去写的那些代码。比如 linux kernel，比如 OTP。

这种阅读有时会让人非常沮丧，因为你会遇见非常非常之多的 knowledge gap，从而不得不翻书查资料弥补这些你缺失的知识点。

-------------------

注：作者所指出的最核心的点是**复盘**和**总结**。这是被当下绝大多数开发人员（包括我）所忽略的。本文将时刻提醒我不断的复盘总结，优化自己的知识体系。

